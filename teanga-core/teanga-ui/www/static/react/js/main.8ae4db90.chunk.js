(this["webpackJsonpreact-flow-101"]=this["webpackJsonpreact-flow-101"]||[]).push([[0],{60:function(e,t,a){},62:function(e,t,a){},65:function(e,t,a){},91:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a(14),c=a.n(r),s=(a(60),a(17)),o=a.n(s),d=a(37),l=a(27),i=a(55),p=a(24),u=a(6),j=a(13),h=(a(62),a(3)),b=function(e){var t=e.data;return Object(h.jsxs)("div",{className:t.selected?"flowchart-operator-new selected-node":"flowchart-operator-new",children:[Object(h.jsx)(j.c,{className:"handle-left",type:"target",position:"left"}),Object(h.jsx)("div",{className:"handle-title",children:t.label}),Object(h.jsx)(j.c,{className:"handle-right",type:"source",position:"right",style:{borderRadius:0}})]})},O=function(e){var t=e.id,a=e.sourceX,n=e.sourceY,r=e.targetX,c=e.targetY,s=e.sourcePosition,o=e.targetPosition,d=e.style,l=void 0===d?{strokeWidth:10,stroke:"rgb(92, 184, 92)"}:d,i=e.data,p=e.arrowHeadType,u=e.markerEndId,b=Object(j.f)({sourceX:a,sourceY:n,sourcePosition:s,targetX:r,targetY:c,targetPosition:o}),O=Object(j.g)(p,u);return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("path",{id:t,style:l,className:"react-flow__edge-path",d:b,markerEnd:O}),Object(h.jsx)("text",{children:Object(h.jsx)("textPath",{href:"#".concat(t),style:{fontSize:"12px"},startOffset:"50%",textAnchor:"middle",children:i.type})})]})},f=a(98),m=a(94);a(64);var y=function(e){var t=e.name,a=(e.key,e.selected),n=e.dispatch;return Object(h.jsx)(f.a,{border:a?"danger":"primary",style:{marginLeft:"0.5vw",marginRight:"0.5vw",width:"15vw",borderRadius:"10px"},children:Object(h.jsxs)(f.a.Body,{children:[Object(h.jsx)(f.a.Title,{style:{maxWidth:"90%",fontSize:"10px"},children:t}),Object(h.jsx)(m.a,{variant:"primary",size:"sm",style:{maxWidth:"90%",fontSize:"10px"},onClick:function(){n({type:G.ADD_NODE,payload:{name:t}})},children:"Add to Workflow"})]})})},x=a(49),E=a.n(x),g=a(96),v=a(50),_=a(95);a(65);var w=function(e){var t=e.services,a=e.input,r=e.dispatch,c=Object(n.useState)(t[0].name),s=Object(l.a)(c,2),o=s[0],d=s[1],i=function(e){var t=e.text,a=e.selected;return Object(h.jsx)(y,{name:t,className:"menu-item",selected:a,dispatch:r},t)},p=function(e){var t=e.text,a=e.className;return Object(h.jsx)("div",{style:{border:"2px solid black"},className:a,children:t})},u=p({text:"<",className:"arrow-prev"}),j=p({text:">",className:"arrow-next"}),b=function(e,t){return e.filter((function(e){return e.name.includes(a)})).map((function(e){var a=e.name;return Object(h.jsx)(i,{text:a,selected:t},a)}))}(t,o);return Object(h.jsxs)(_.a,{children:[Object(h.jsxs)(g.a,{size:"sm",className:"mb-3",children:[Object(h.jsx)(g.a.Prepend,{children:Object(h.jsx)(g.a.Text,{id:"inputGroup-sizing-sm",children:"Search : "})}),Object(h.jsx)(v.a,{className:"searchbar-input","aria-label":"Small","aria-describedby":"inputGroup-sizing-sm",type:"text",value:a,onChange:function(e){return r({type:G.UPDATE_INPUT,payload:{input:e.target.value}})}})]}),Object(h.jsx)(E.a,{style:{width:"100%"},data:b,arrowLeft:u,arrowRight:j,selected:o,onSelect:function(e){d(e)}})]})},k=a(97),C=a(22);var N=function(e){var t=e.node,a=(e.selectedPath,e.paths),n=e.methods,r=e.parameters,c=e.requestBody,s=e.dispatch;if(c)var o=Object.keys(c.content).map((function(e){return Object(h.jsx)("option",{children:e})}));else o=[];return Object(h.jsxs)("div",{style:{position:"fixed",top:"50px",left:"0",height:"100%",width:"30%",zIndex:999,border:"2px solid black",background:"white",overflowY:"auto"},children:[Object(h.jsxs)("h3",{children:[" ",t.data.label," "]}),Object(h.jsx)(m.a,{variant:"primary",type:"submit",style:{marginTop:"-70px",marginLeft:"100%"},onClick:function(){return s({type:G.UNSELECT_NODE,payload:{id:t.id}})},children:Object(h.jsx)(C.a,{})}),Object(h.jsxs)(k.a,{children:[Object(h.jsxs)(k.a.Group,{className:"service-leftbar-group",controlId:"exampleForm.ControlSelect1",children:[Object(h.jsx)(k.a.Label,{children:"Select an Endpoint"}),Object(h.jsx)(k.a.Control,{as:"select",defaultValue:t.workflow.selectedPath,onChange:function(e){return s({type:G.SELECT_FORM_VALUE,payload:{field:"selectedPath",value:e.target.value}})},children:a.map((function(e){return Object(h.jsx)("option",{children:e})}))})]}),Object(h.jsxs)(k.a.Group,{className:"service-leftbar-group",controlId:"exampleForm.ControlSelect2",children:[Object(h.jsx)(k.a.Label,{children:"Select an Request method"}),Object(h.jsx)(k.a.Control,{as:"select",defaultValue:t.workflow.selectedMethod,onChange:function(e){return s({type:G.SELECT_FORM_VALUE,payload:{field:"requestBody",value:e.target.value}})},children:n.map((function(e){return Object(h.jsx)("option",{children:e})}))})]}),c?Object(h.jsxs)(k.a.Group,{className:"service-leftbar-group",controlId:"exampleForm.ControlSelect2",children:[Object(h.jsx)(k.a.Label,{children:"Select a Request Body "}),Object(h.jsx)(k.a.Control,{as:"select",onChange:function(e){return s({type:G.SELECT_FORM_VALUE,payload:{field:"selectedMethod",value:e.target.value}})},children:o}),Object(h.jsx)(k.a.Control,{as:"textarea",rows:3,onChange:function(e){return s({type:G.SELECT_FORM_VALUE,payload:{field:"requestBody",value:JSON.parse(e.target.value)}})}})]}):"",Object(h.jsx)("h3",{children:" Parameters "}),Object(h.jsx)(k.a.Group,{className:"service-leftbar-group",children:r?r.map((function(e){return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)(k.a.Label,{children:[e.name," (",e.required?"required":"optional",") "]}),Object(h.jsx)(k.a.Control,{type:"text",defaultValue:t.workflow[e.name]?t.workflow[e.name]:"Enter parameter value",placeholder:"Enter parameter value",onChange:function(t){return s({type:G.SELECT_FORM_VALUE,payload:{field:e.name,value:t.target.value}})}})]})})):""})]}),Object(h.jsx)(m.a,{className:"service-leftbar-button",variant:"primary",type:"submit",style:{marginBottom:"100px"},onClick:function(e){return s({type:G.UNSELECT_NODE,payload:{id:t.id}})},children:"Save Inputs"})]})};var P=function(e){var t=e.edge,a=e.operators,n=e.dispatch;return Object(h.jsxs)("div",{style:{position:"fixed",top:"50px",left:"0",height:"100%",width:"30%",zIndex:999,border:"2px solid black",background:"white",overflowY:"auto"},children:[Object(h.jsxs)("h3",{children:[" ",t.data.type," "]}),Object(h.jsx)(k.a,{children:Object(h.jsxs)(k.a.Group,{className:"service-leftbar-group",controlId:"exampleForm.ControlSelect1",children:[Object(h.jsx)(k.a.Label,{children:"Select an Endpoint"}),Object(h.jsx)(k.a.Control,{as:"select",onChange:function(e){return n({type:G.UPDATE_EDGE_TYPE,payload:{field:"type",value:e.target.value}})},children:a.map((function(e){return Object(h.jsx)("option",{children:e})}))})]})}),Object(h.jsx)(m.a,{className:"service-leftbar-button",variant:"primary",type:"submit",style:{marginBottom:"100px"},onClick:function(e){return n({type:G.UNSELECT_EDGE,payload:{id:t.id}})},children:"Save Inputs"})]})},T=a(38),S=a(39);var D=function(){return Object(h.jsx)(T.a,{bg:"dark",variant:"dark",fixed:"top",expand:"lg",style:{height:"50px"},children:Object(h.jsxs)(_.a,{children:[Object(h.jsx)(T.a.Brand,{href:"#home",children:Object(h.jsxs)("a",{class:"navbar-brand",style:{position:"fixed",left:"5%",marginTop:"-25px"},href:"../platform",children:[Object(h.jsx)("img",{class:"pull-left",src:"/static/images/teanga-logo-white.svg",height:"40"})," \xa0",Object(h.jsx)("span",{class:"name",children:Object(h.jsx)("span",{class:"beta",children:"MVP"})})]})}),Object(h.jsx)(S.a,{className:"me-auto",children:Object(h.jsx)(S.a.Link,{href:"/admin",children:"Go to Airflow"})})]})})},L=a(53),I=a(54),M=a.n(I),A={teangaNode:b},R={teangaEdge:O},U={node_count:0,input:"",selected_nodeId:"",selected_edgeId:"",selectedPath:"",selectedMethod:"",methods:[],paths:[],requestBody:{},services:[],operators:["pass","wait","forEach","concatenate","merge"],elements:[]},G={SET_OPENAPI:"set-openapi",CREATE_WORKFLOW:"create-workflow",UPDATE_INPUT:"update-input",ADD_NODE:"add-node",ADD_EDGE:"add-edge",SELECT_NODE:"select-node",UNSELECT_NODE:"unselect-node",SELECT_EDGE:"select-edge",REMOVE_SELECTED_NODE:"remove-selected-node",SELECT_FORM_VALUE:"select-form-value",UPDATE_EDGE_TYPE:"update-edge-type"};function F(e,t){switch(t.type){case G.SET_OPENAPI:return C=Object(u.a)(Object(u.a)({},e),{},{services:t.payload.services.map((function(e,a){return Object(u.a)(Object(u.a)({},e),{},{openapi:t.payload.openapi_yamls[a]})}))});case G.CREATE_WORKFLOW:console.log("state services",e.services);var a,n={},r=Object(p.a)(e.elements);try{for(r.s();!(a=r.n()).done;){var c=a.value;if("teangaNode"===c.type){n.hasOwnProperty(c.id)||(n[c.id]=Object(u.a)({},c.workflow));var s,o=Object(p.a)(e.elements);try{for(o.s();!(s=o.n()).done;){var d=s.value;"teangaEdge"===d.type&&d.target===c.id&&(n[c.id].dependencies=[].concat(Object(i.a)(n[c.id].dependencies),[d]))}}catch(A){o.e(A)}finally{o.f()}}}}catch(A){r.e(A)}finally{r.f()}for(var h=0,b=Object.keys(n);h<b.length;h++){var O=b[h];for(var f in n[O].dependencies){var m=n[O].dependencies[f];n[O].dependencies[f]={operator:m.data.type,steps:[m.source]}}}return console.log(n),M.a.post("/admin/ping",n).then((function(e){alert("creation sucessful"),window.resp=e,window.location="/admin/"})).catch((function(e){alert("creation failed :(")})),Object(u.a)({},e);case G.UPDATE_INPUT:return Object(u.a)(Object(u.a)({},e),{},{input:t.payload.input});case G.ADD_NODE:var y=e.services.filter((function(e){return e.name===t.payload.name}))[0],x=y.openapi;console.log(y);var E=(D=Object.keys(x.paths).map((function(e){return e})))[0],g=(L=Object.keys(x.paths[E]))[0],v=x.paths[E][g].parameters,_=x.paths[E][g].requestBody,w=x.paths[E][g].operationId,k={id:(e.node_count+1).toString(),type:"teangaNode",data:{label:t.payload.name,selected:!1,openapi:x},workflow:{selectedPath:E,selectedMethod:g,operation_id:w,repo:y.repo,image_id:y.image_id,image_tag:y.image_tag,host_port:y.host_port,container_port:y.container_port,input:{},dependencies:[]},position:{x:50,y:50}},C=Object(u.a)(Object(u.a)({},e),{},{node_count:e.node_count+1,elements:e.elements.concat(k)});return console.log(C),C;case G.ADD_EDGE:console.log(t.payload.params);var N=Object(j.d)(t.payload.params,[e.elements[0],e.elements[0]]),P=Object(l.a)(N,3),T=(P[0],P[1],P[2]);return C=Object(u.a)(Object(u.a)({},e),{},{node_count:e.node_count+1,elements:e.elements.concat(T)});case G.SELECT_EDGE:return C=Object(u.a)(Object(u.a)({},e),{},{selected_edgeId:t.payload.id,elements:e.elements.map((function(e){return e.id===t.payload.id?Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!e.data.selected})}):Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!1})})}))});case G.UNSELECT_EDGE:return C=Object(u.a)(Object(u.a)({},e),{},{selected_edgeId:"",elements:e.elements.map((function(e){return e.id,t.payload.id,Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!1})})}))});case G.SELECT_NODE:if(""!==(I=e.selected_nodeId==t.payload.id?"":t.payload.id)){var S=e.elements.filter((function(e){return e.id===I}))[0],D=Object.keys(S.data.openapi.paths).map((function(e){return e})),L=(E=S.workflow.selectedPath,Object.keys(S.data.openapi.paths[E]));g=S.workflow.selectedMethod,v=S.data.openapi.paths[E][g].parameters?S.data.openapi.paths[E][g].parameters:[],_=S.data.openapi.paths[E][g].requestBody?S.data.openapi.paths[E][g].requestBody:""}else D=[],E="",L=[],g="",v=[],_={};return C=Object(u.a)(Object(u.a)({},e),{},{selected_nodeId:I,selectedPath:E,methods:L,selectedMethod:g,paths:D,parameters:v,requestBody:_,elements:e.elements.map((function(e){return e.id===t.payload.id?Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!e.data.selected})}):Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!1})})}))});case G.UNSELECT_NODE:return C=Object(u.a)(Object(u.a)({},e),{},{selected_nodeId:"",selectedPath:"",selectedMethod:"",methods:[],paths:[],elements:e.elements.map((function(e){return e.id,t.payload.id,Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!1})})}))});case G.REMOVE_SELECTED_NODE:return C=Object(u.a)(Object(u.a)({},e),{},{selected_nodeId:"",elements:e.elements.filter((function(e){return e.id!==t.payload.id&&(e.source!==t.payload.id&&e.target!==t.payload.id)}))});case G.SELECT_FORM_VALUE:var I=e.selected_nodeId;x=(k=e.elements.filter((function(e){return e.id===I}))[0]).data.openapi,D=Object.keys(k.data.openapi.paths).map((function(e){return e})),E="selectedPath"==t.payload.field?t.payload.value:e.selectedPath,L=Object.keys(k.data.openapi.paths[E]);if("selectedMethod"==t.payload.field)g=t.payload.value;else if(-1!==L.indexOf(e.selectedMethod))g=e.selectedMethod;else g=L[0];v=x.paths[E][g].parameters;if(-1===["selectedPath","selectedMethod"].indexOf(t.payload.field))k.workflow.input[t.payload.field]=t.payload.value;else{w=x.paths[E][g].operationId;k.workflow=Object(u.a)(Object(u.a)({},k.workflow),{},{selectedPath:E,selectedMethod:g,operation_id:w})}return console.log(k),C=Object(u.a)(Object(u.a)({},e),{},{elements:e.elements.map((function(e){return e.id===I?k:e})),selectedPath:E,methods:L,selectedMethod:g,parameters:v});case G.UPDATE_EDGE_TYPE:I=e.selected_nodeId,x=(k=e.elements.filter((function(e){return e.id===I}))[0]).data.openapi,D=Object.keys(k.data.openapi.paths).map((function(e){return e})),E="selectedPath"==t.payload.field?t.payload.value:e.selectedPath,L=Object.keys(k.data.openapi.paths[E]);if("selectedMethod"==t.payload.field)g=t.payload.value;else if(-1!==L.indexOf(e.selectedMethod))g=e.selectedMethod;else g=L[0];v=x.paths[E][g].parameters;if(-1===["selectedPath","selectedMethod"].indexOf(t.payload.field))k.workflow.input[t.payload.field]=t.payload.value;else{w=x.paths[E][g].operationId;k.workflow=Object(u.a)(Object(u.a)({},k.workflow),{},{selectedPath:E,selectedMethod:g,operation_id:w})}return console.log(k),C=Object(u.a)(Object(u.a)({},e),{},{elements:e.elements.map((function(e){return e.id===I?k:e})),selectedPath:E,methods:L,selectedMethod:g,parameters:v});default:return e}}var B=function(){var e=Object(n.useReducer)(F,U),t=Object(l.a)(e,2),a=t[0],r=t[1];return Object(n.useEffect)(Object(d.a)(o.a.mark((function e(){var t,a,n,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://raw.githubusercontent.com/berstearns/personal/main/services").then((function(e){return e.text()}));case 2:return t=e.sent,a=JSON.parse(t),n=a.map(function(){var e=Object(d.a)(o.a.mark((function e(t){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t.url).then((function(e){return e.text()}));case 2:return a=e.sent,n=Object(L.parse)(a),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,Promise.all(n);case 7:c=e.sent,r({type:G.SET_OPENAPI,payload:{services:a,openapi_yamls:c}});case 9:case"end":return e.stop()}}),e)}))),[]),Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(D,{}),Object(h.jsxs)("div",{style:{width:"100%"},children:[Object(h.jsx)("h3",{style:{display:"inline-block","margin-left":"5%","margin-top":"5%"},children:" Build a workflow from the Flow Diagram "}),Object(h.jsx)(m.a,{variant:"primary",size:"lg",style:{maxWidth:"90%",fontSize:"10px",marginLeft:"30%"},onClick:function(){r({type:G.CREATE_WORKFLOW,payload:{}})},children:"Create Workflow"})]}),a.selected_nodeId?Object(h.jsx)(N,{node:a.elements.filter((function(e){return e.id===a.selected_nodeId}))[0],dispatch:r,selectedPath:a.selectedPath,paths:a.paths,methods:a.methods,selectedMethod:a.selectedMethod,parameters:a.parameters,requestBody:a.requestBody}):"",a.selected_edgeId?Object(h.jsx)(P,{edge:a.elements.filter((function(e){return e.id===a.selected_edgeId}))[0],operators:a.operators,dispatch:r}):"",Object(h.jsxs)("div",{style:{background:"white",border:"2px solid black",padding:"5% 5% 5% 5%",width:"90%",marginLeft:"auto",marginRight:"auto",marginTop:"3%"},children:[a.services.length>0?Object(h.jsx)(w,{services:a.services,dispatch:r,input:a.input}):"",Object(h.jsx)("div",{id:"chart_area",children:Object(h.jsx)(j.e,{elements:a.elements,onConnect:function(e){return r({type:G.ADD_EDGE,payload:{params:Object(u.a)(Object(u.a)({},e),{},{id:(a.node_count+1).toString(),type:"teangaEdge",data:{type:"pass"}})}})},onElementClick:function(e,t){t.source?r({type:G.SELECT_EDGE,payload:{id:t.id}}):t.id&&r({type:G.SELECT_NODE,payload:{id:t.id}})},nodeTypes:A,edgeTypes:R,children:Object(h.jsx)(j.b,{style:{marginLeft:"95%"},children:Object(h.jsx)(j.a,{onClick:function(){return r({type:G.REMOVE_SELECTED_NODE,payload:{id:a.selected_nodeId}})},children:Object(h.jsx)(C.a,{})})})})})]})]})};c.a.render(Object(h.jsx)(B,{}),document.getElementById("root"))}},[[91,1,2]]]);
//# sourceMappingURL=main.8ae4db90.chunk.js.map