(this["webpackJsonpreact-flow-101"]=this["webpackJsonpreact-flow-101"]||[]).push([[0],{53:function(e,t,a){},55:function(e,t,a){},58:function(e,t,a){},84:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a(14),s=a.n(n),c=(a(53),a(15)),o=a.n(c),d=a(29),l=a(25),i=a(47),p=a(22),u=a(5),h=a(13),j=(a(55),a(3)),b=function(e){var t=e.data;return Object(j.jsxs)("div",{className:t.selected?"flowchart-operator-new selected-node":"flowchart-operator-new",children:[Object(j.jsx)(h.c,{className:"handle-left",type:"target",position:"left"}),Object(j.jsx)("div",{className:"handle-title",children:t.label}),Object(j.jsx)(h.c,{className:"handle-right",type:"source",position:"right",style:{borderRadius:0}})]})},m=function(e){var t=e.id,a=e.sourceX,r=e.sourceY,n=e.targetX,s=e.targetY,c=e.sourcePosition,o=e.targetPosition,d=e.style,l=void 0===d?{strokeWidth:10,stroke:"rgb(92, 184, 92)"}:d,i=e.data,p=e.arrowHeadType,u=e.markerEndId,b=Object(h.f)({sourceX:a,sourceY:r,sourcePosition:c,targetX:n,targetY:s,targetPosition:o}),m=Object(h.g)(p,u);return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("path",{id:t,style:l,className:"react-flow__edge-path",d:b,markerEnd:m}),Object(j.jsx)("text",{children:Object(j.jsx)("textPath",{href:"#".concat(t),style:{fontSize:"12px"},startOffset:"50%",textAnchor:"middle",children:i.type})})]})},O=a(90),f=a(91);a(57);var y=function(e){var t=e.name,a=(e.key,e.selected),r=e.dispatch;return Object(j.jsx)(O.a,{border:a?"danger":"primary",style:{marginLeft:"0.5vw",marginRight:"0.5vw",width:"15vw",borderRadius:"10px"},children:Object(j.jsxs)(O.a.Body,{children:[Object(j.jsx)(O.a.Title,{style:{maxWidth:"90%",fontSize:"10px"},children:t}),Object(j.jsx)(f.a,{variant:"primary",size:"sm",style:{maxWidth:"90%",fontSize:"10px"},onClick:function(){r({type:U.ADD_NODE,payload:{name:t}})},children:"Add to Workflow"})]})})},g=a(41),E=a.n(g),x=a(88),_=a(42),v=a(87);a(58);var w=function(e){var t=e.services,a=e.input,n=e.dispatch,s=Object(r.useState)(t[0].name),c=Object(l.a)(s,2),o=c[0],d=c[1],i=function(e){var t=e.text,a=e.selected;return Object(j.jsx)(y,{name:t,className:"menu-item",selected:a,dispatch:n},t)},p=function(e){var t=e.text,a=e.className;return Object(j.jsx)("div",{style:{border:"2px solid black"},className:a,children:t})},u=p({text:"<",className:"arrow-prev"}),h=p({text:">",className:"arrow-next"}),b=function(e,t){return e.filter((function(e){return e.name.includes(a)})).map((function(e){var a=e.name;return Object(j.jsx)(i,{text:a,selected:t},a)}))}(t,o);return Object(j.jsxs)(v.a,{children:[Object(j.jsxs)(x.a,{size:"sm",className:"mb-3",children:[Object(j.jsx)(x.a.Prepend,{children:Object(j.jsx)(x.a.Text,{id:"inputGroup-sizing-sm",children:"Search : "})}),Object(j.jsx)(_.a,{className:"searchbar-input","aria-label":"Small","aria-describedby":"inputGroup-sizing-sm",type:"text",value:a,onChange:function(e){return n({type:U.UPDATE_INPUT,payload:{input:e.target.value}})}})]}),Object(j.jsx)(E.a,{style:{width:"100%"},data:b,arrowLeft:u,arrowRight:h,selected:o,onSelect:function(e){d(e)}})]})},k=a(89),C=a(20);var P=function(e){var t=e.node,a=(e.selectedPath,e.paths),r=e.methods,n=e.parameters,s=e.requestBody,c=e.dispatch;if(s)var o=Object.keys(s.content).map((function(e){return Object(j.jsx)("option",{children:e})}));else o=[];return Object(j.jsxs)("div",{style:{position:"fixed",top:"50px",left:"0",height:"100%",width:"30%",zIndex:999,border:"2px solid black",background:"white",overflowY:"auto"},children:[Object(j.jsxs)("h3",{children:[" ",t.data.label," "]}),Object(j.jsx)(f.a,{variant:"primary",type:"submit",style:{marginTop:"-70px",marginLeft:"100%"},onClick:function(){return c({type:U.UNSELECT_NODE,payload:{id:t.id}})},children:Object(j.jsx)(C.a,{})}),Object(j.jsxs)(k.a,{children:[Object(j.jsxs)(k.a.Group,{className:"service-leftbar-group",controlId:"exampleForm.ControlSelect1",children:[Object(j.jsx)(k.a.Label,{children:"Select an Endpoint"}),Object(j.jsx)(k.a.Control,{as:"select",defaultValue:t.workflow.selectedPath,onChange:function(e){return c({type:U.SELECT_FORM_VALUE,payload:{field:"selectedPath",value:e.target.value}})},children:a.map((function(e){return Object(j.jsx)("option",{children:e})}))})]}),Object(j.jsxs)(k.a.Group,{className:"service-leftbar-group",controlId:"exampleForm.ControlSelect2",children:[Object(j.jsx)(k.a.Label,{children:"Select an Request method"}),Object(j.jsx)(k.a.Control,{as:"select",defaultValue:t.workflow.selectedMethod,onChange:function(e){return c({type:U.SELECT_FORM_VALUE,payload:{field:"requestBody",value:e.target.value}})},children:r.map((function(e){return Object(j.jsx)("option",{children:e})}))})]}),s?Object(j.jsxs)(k.a.Group,{className:"service-leftbar-group",controlId:"exampleForm.ControlSelect2",children:[Object(j.jsx)(k.a.Label,{children:"Select a Request Body "}),Object(j.jsx)(k.a.Control,{as:"select",onChange:function(e){return c({type:U.SELECT_FORM_VALUE,payload:{field:"selectedMethod",value:e.target.value}})},children:o}),Object(j.jsx)(k.a.Control,{as:"textarea",rows:3,onChange:function(e){return c({type:U.SELECT_FORM_VALUE,payload:{field:"requestBody",value:JSON.parse(e.target.value)}})}})]}):"",Object(j.jsx)("h3",{children:" Parameters "}),Object(j.jsx)(k.a.Group,{className:"service-leftbar-group",children:n?n.map((function(e){return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)(k.a.Label,{children:[e.name," (",e.required?"required":"optional",") "]}),Object(j.jsx)(k.a.Control,{type:"text",defaultValue:t.workflow[e.name]?t.workflow[e.name]:"Enter parameter value",placeholder:"Enter parameter value",onChange:function(t){return c({type:U.SELECT_FORM_VALUE,payload:{field:e.name,value:t.target.value}})}})]})})):""})]}),Object(j.jsx)(f.a,{className:"service-leftbar-button",variant:"primary",type:"submit",style:{marginBottom:"100px"},onClick:function(e){return c({type:U.UNSELECT_NODE,payload:{id:t.id}})},children:"Save Inputs"})]})};var N=function(e){var t=e.edge,a=e.operators,r=e.dispatch;return Object(j.jsxs)("div",{style:{position:"fixed",top:"70px",left:"0",height:"100%",width:"30%",zIndex:999,border:"2px solid black",background:"white",overflowY:"auto"},children:[Object(j.jsxs)("h3",{children:[" ",t.data.type," "]}),Object(j.jsx)(k.a,{children:Object(j.jsxs)(k.a.Group,{className:"service-leftbar-group",controlId:"exampleForm.ControlSelect1",children:[Object(j.jsx)(k.a.Label,{children:"Select an Endpoint"}),Object(j.jsx)(k.a.Control,{as:"select",onChange:function(e){return r({type:U.UPDATE_EDGE_TYPE,payload:{field:"type",value:e.target.value}})},children:a.map((function(e){return Object(j.jsx)("option",{children:e})}))})]})}),Object(j.jsx)(f.a,{className:"service-leftbar-button",variant:"primary",type:"submit",style:{marginBottom:"100px"},onClick:function(e){return r({type:U.UNSELECT_EDGE,payload:{id:t.id}})},children:"Save Inputs"})]})},T=a(30);var D=function(){return Object(j.jsx)(T.a,{bg:"dark",variant:"dark",fixed:"top",expand:"lg",style:{height:"50px"},children:Object(j.jsx)(T.a.Brand,{href:"#home",children:Object(j.jsxs)("a",{class:"navbar-brand",style:{position:"fixed",left:"5%",marginTop:"-25px"},href:"../platform",children:[Object(j.jsx)("img",{class:"pull-left",src:"/static/images/teanga-logo-white.svg",height:"40"})," \xa0",Object(j.jsx)("span",{class:"name",children:Object(j.jsx)("span",{class:"beta",children:"MVP"})})]})})})},S=a(45),L=a(46),I=a.n(L),M={teangaNode:b},A={teangaEdge:m},R={node_count:0,input:"",selected_nodeId:"",selected_edgeId:"",selectedPath:"",selectedMethod:"",methods:[],paths:[],requestBody:{},services:[{name:"SWC - Chunker",url:"https://raw.githubusercontent.com/berstearns/personal/main/swcchunker",repo:"berstearns",image_id:"teanga-swc-chunker",image_tag:"122021",host_port:8001,container_port:8080},{name:"DKPRO pos tagger",url:"https://raw.githubusercontent.com/berstearns/personal/main/postagger",repo:"berstearns",image_id:"teanga-postagger",image_tag:"122021",host_port:8001,container_port:8080},{name:"dummy teanga",url:"https://raw.githubusercontent.com/berstearns/personal/main/dummy.yaml",repo:"berstearns",image_id:"dummy_teanga_service",image_tag:"042021",host_port:8001,container_port:8080},{name:"dkpro-treetagger",url:"https://raw.githubusercontent.com/berstearns/personal/main/dkpro.yaml",repo:"berstearns",image_id:"teanga-dkpro-wrapper",image_tag:"032021",host_port:8001,container_port:8080},{name:"naisc",url:"https://raw.githubusercontent.com/berstearns/personal/main/naisc.yaml",repo:"berstearns",image_id:"naisc",image_tag:"latest",host_port:8001,container_port:8080}],operators:["pass","wait","forEach"],elements:[]},U={SET_OPENAPI:"set-openapi",CREATE_WORKFLOW:"create-workflow",UPDATE_INPUT:"update-input",ADD_NODE:"add-node",ADD_EDGE:"add-edge",SELECT_NODE:"select-node",UNSELECT_NODE:"unselect-node",SELECT_EDGE:"select-edge",REMOVE_SELECTED_NODE:"remove-selected-node",SELECT_FORM_VALUE:"select-form-value",UPDATE_EDGE_TYPE:"update-edge-type"};function F(e,t){switch(t.type){case U.SET_OPENAPI:return C=Object(u.a)(Object(u.a)({},e),{},{services:e.services.map((function(e,a){return Object(u.a)(Object(u.a)({},e),{},{openapi:t.payload.openapi_yamls[a]})}))});case U.CREATE_WORKFLOW:console.log("state services",e.services);var a,r={},n=Object(p.a)(e.elements);try{for(n.s();!(a=n.n()).done;){var s=a.value;if("teangaNode"===s.type){r.hasOwnProperty(s.id)||(r[s.id]=Object(u.a)({},s.workflow));var c,o=Object(p.a)(e.elements);try{for(o.s();!(c=o.n()).done;){var d=c.value;"teangaEdge"===d.type&&d.target===s.id&&(r[s.id].dependencies=[].concat(Object(i.a)(r[s.id].dependencies),[d]))}}catch(A){o.e(A)}finally{o.f()}}}}catch(A){n.e(A)}finally{n.f()}for(var j=0,b=Object.keys(r);j<b.length;j++){var m=b[j];for(var O in r[m].dependencies){var f=r[m].dependencies[O];r[m].dependencies[O]={operator:f.data.type,steps:[f.source]}}}return console.log(r),I.a.post("/admin/ping",r).then((function(e){window.resp=e})).catch((function(e){alert("creation failed :(")})),Object(u.a)({},e);case U.UPDATE_INPUT:return Object(u.a)(Object(u.a)({},e),{},{input:t.payload.input});case U.ADD_NODE:var y=e.services.filter((function(e){return e.name===t.payload.name}))[0],g=y.openapi;console.log(y);var E=(S=Object.keys(g.paths).map((function(e){return e})))[0],x=(L=Object.keys(g.paths[E]))[0],_=g.paths[E][x].parameters,v=g.paths[E][x].requestBody,w=g.paths[E][x].operationId,k={id:(e.node_count+1).toString(),type:"teangaNode",data:{label:t.payload.name,selected:!1,openapi:g},workflow:{selectedPath:E,selectedMethod:x,operation_id:w,repo:y.repo,image_id:y.image_id,image_tag:y.image_tag,host_port:y.host_port,container_port:y.container_port,input:{},dependencies:[]},position:{x:50,y:50}},C=Object(u.a)(Object(u.a)({},e),{},{node_count:e.node_count+1,elements:e.elements.concat(k)});return console.log(C),C;case U.ADD_EDGE:console.log(t.payload.params);var P=Object(h.d)(t.payload.params,[e.elements[0],e.elements[0]]),N=Object(l.a)(P,3),T=(N[0],N[1],N[2]);return C=Object(u.a)(Object(u.a)({},e),{},{elements:e.elements.concat(T)});case U.SELECT_EDGE:return C=Object(u.a)(Object(u.a)({},e),{},{selected_edgeId:t.payload.id,elements:e.elements.map((function(e){return e.id===t.payload.id?Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!e.data.selected})}):Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!1})})}))});case U.UNSELECT_EDGE:return C=Object(u.a)(Object(u.a)({},e),{},{selected_edgeId:"",elements:e.elements.map((function(e){return e.id,t.payload.id,Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!1})})}))});case U.SELECT_NODE:if(""!==(M=e.selected_nodeId==t.payload.id?"":t.payload.id)){var D=e.elements.filter((function(e){return e.id===M}))[0],S=Object.keys(D.data.openapi.paths).map((function(e){return e})),L=(E=D.workflow.selectedPath,Object.keys(D.data.openapi.paths[E]));x=D.workflow.selectedMethod,_=D.data.openapi.paths[E][x].parameters?D.data.openapi.paths[E][x].parameters:[],v=D.data.openapi.paths[E][x].requestBody?D.data.openapi.paths[E][x].requestBody:""}else S=[],E="",L=[],x="",_=[],v={};return C=Object(u.a)(Object(u.a)({},e),{},{selected_nodeId:M,selectedPath:E,methods:L,selectedMethod:x,paths:S,parameters:_,requestBody:v,elements:e.elements.map((function(e){return e.id===t.payload.id?Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!e.data.selected})}):Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!1})})}))});case U.UNSELECT_NODE:return C=Object(u.a)(Object(u.a)({},e),{},{selected_nodeId:"",selectedPath:"",selectedMethod:"",methods:[],paths:[],elements:e.elements.map((function(e){return e.id,t.payload.id,Object(u.a)(Object(u.a)({},e),{},{data:Object(u.a)(Object(u.a)({},e.data),{},{selected:!1})})}))});case U.REMOVE_SELECTED_NODE:return C=Object(u.a)(Object(u.a)({},e),{},{selected_nodeId:"",elements:e.elements.filter((function(e){return e.id!==t.payload.id&&(e.source!==t.payload.id&&e.target!==t.payload.id)}))});case U.SELECT_FORM_VALUE:var M=e.selected_nodeId;g=(k=e.elements.filter((function(e){return e.id===M}))[0]).data.openapi,S=Object.keys(k.data.openapi.paths).map((function(e){return e})),E="selectedPath"==t.payload.field?t.payload.value:e.selectedPath,L=Object.keys(k.data.openapi.paths[E]);if("selectedMethod"==t.payload.field)x=t.payload.value;else if(-1!==L.indexOf(e.selectedMethod))x=e.selectedMethod;else x=L[0];_=g.paths[E][x].parameters;if(-1===["selectedPath","selectedMethod"].indexOf(t.payload.field))k.workflow.input[t.payload.field]=t.payload.value;else{w=g.paths[E][x].operationId;k.workflow=Object(u.a)(Object(u.a)({},k.workflow),{},{selectedPath:E,selectedMethod:x,operation_id:w})}return console.log(k),C=Object(u.a)(Object(u.a)({},e),{},{elements:e.elements.map((function(e){return e.id===M?k:e})),selectedPath:E,methods:L,selectedMethod:x,parameters:_});case U.UPDATE_EDGE_TYPE:M=e.selected_nodeId,g=(k=e.elements.filter((function(e){return e.id===M}))[0]).data.openapi,S=Object.keys(k.data.openapi.paths).map((function(e){return e})),E="selectedPath"==t.payload.field?t.payload.value:e.selectedPath,L=Object.keys(k.data.openapi.paths[E]);if("selectedMethod"==t.payload.field)x=t.payload.value;else if(-1!==L.indexOf(e.selectedMethod))x=e.selectedMethod;else x=L[0];_=g.paths[E][x].parameters;if(-1===["selectedPath","selectedMethod"].indexOf(t.payload.field))k.workflow.input[t.payload.field]=t.payload.value;else{w=g.paths[E][x].operationId;k.workflow=Object(u.a)(Object(u.a)({},k.workflow),{},{selectedPath:E,selectedMethod:x,operation_id:w})}return console.log(k),C=Object(u.a)(Object(u.a)({},e),{},{elements:e.elements.map((function(e){return e.id===M?k:e})),selectedPath:E,methods:L,selectedMethod:x,parameters:_});default:return e}}var G=function(){var e=Object(r.useReducer)(F,R),t=Object(l.a)(e,2),a=t[0],n=t[1];return Object(r.useEffect)(Object(d.a)(o.a.mark((function e(){var t,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.services.map(function(){var e=Object(d.a)(o.a.mark((function e(t){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t.url).then((function(e){return e.text()}));case 2:return a=e.sent,r=Object(S.parse)(a),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.all(t);case 3:r=e.sent,n({type:U.SET_OPENAPI,payload:{openapi_yamls:r}});case 5:case"end":return e.stop()}}),e)}))),[]),Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(D,{}),Object(j.jsxs)("div",{style:{width:"100%"},children:[Object(j.jsx)("h3",{style:{display:"inline-block","margin-left":"5%","margin-top":"5%"},children:" Build a workflow from the Flow Diagram "}),Object(j.jsx)(f.a,{variant:"primary",size:"lg",style:{maxWidth:"90%",fontSize:"10px",marginLeft:"30%"},onClick:function(){n({type:U.CREATE_WORKFLOW,payload:{}})},children:"Create Workflow"})]}),a.selected_nodeId?Object(j.jsx)(P,{node:a.elements.filter((function(e){return e.id===a.selected_nodeId}))[0],dispatch:n,selectedPath:a.selectedPath,paths:a.paths,methods:a.methods,selectedMethod:a.selectedMethod,parameters:a.parameters,requestBody:a.requestBody}):"",a.selected_edgeId?Object(j.jsx)(N,{edge:a.elements.filter((function(e){return e.id===a.selected_edgeId}))[0],operators:a.operators,dispatch:n}):"",Object(j.jsxs)("div",{style:{background:"white",border:"2px solid black",padding:"5% 5% 5% 5%",width:"90%",marginLeft:"auto",marginRight:"auto",marginTop:"3%"},children:[Object(j.jsx)(w,{services:a.services,dispatch:n,input:a.input}),Object(j.jsx)("div",{id:"chart_area",children:Object(j.jsx)(h.e,{elements:a.elements,onConnect:function(e){return n({type:U.ADD_EDGE,payload:{params:Object(u.a)(Object(u.a)({},e),{},{id:(a.node_count+1).toString(),type:"teangaEdge",data:{type:"pass"}})}})},onElementClick:function(e,t){t.source?n({type:U.SELECT_EDGE,payload:{id:t.id}}):t.id&&n({type:U.SELECT_NODE,payload:{id:t.id}})},nodeTypes:M,edgeTypes:A,children:Object(j.jsx)(h.b,{style:{marginLeft:"95%"},children:Object(j.jsx)(h.a,{onClick:function(){return n({type:U.REMOVE_SELECTED_NODE,payload:{id:a.selected_nodeId}})},children:Object(j.jsx)(C.a,{})})})})})]})]})};s.a.render(Object(j.jsx)(G,{}),document.getElementById("root"))}},[[84,1,2]]]);
//# sourceMappingURL=main.aa4c6783.chunk.js.map