
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Client Quickstart &#8212; Teanga</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/teanga-logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
    <link rel="canonical" href="http://pret-a-llod.github.io/teanga/examples/client_quickstart.html"/>
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="client-quickstart">
<span id="aiohttp-client-quickstart"></span><h1>Client Quickstart<a class="headerlink" href="#client-quickstart" title="Permalink to this headline">¶</a></h1>
<p>Eager to get started? This page gives a good introduction in how to
get started with aiohttp client API.</p>
<p>First, make sure that aiohttp is <span class="xref std std-ref">installed</span> and <em>up-to-date</em></p>
<p>Let’s get started with some simple examples.</p>
<div class="section" id="make-a-request">
<h2>Make a Request<a class="headerlink" href="#make-a-request" title="Permalink to this headline">¶</a></h2>
<p>Begin by importing the aiohttp module:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aiohttp</span>
</pre></div>
</div>
<p>Now, let’s try to get a web-page. For example let’s query
<code class="docutils literal notranslate"><span class="pre">http://httpbin.org/get</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
<p>Now, we have a <code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code> called <code class="docutils literal notranslate"><span class="pre">session</span></code> and a
<a class="reference internal" href="client_reference.html#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientResponse</span></code></a> object called <code class="docutils literal notranslate"><span class="pre">resp</span></code>. We can get all the
information we need from the response.  The mandatory parameter of
<code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.get()</span></code> coroutine is an HTTP <em>url</em> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code> or
class:<cite>yarl.URL</cite> instance).</p>
<p>In order to make an HTTP POST request use <code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.post()</span></code> coroutine:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Other HTTP methods are available as well:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/put&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/delete&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/patch&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Don’t create a session per request. Most likely you need a session
per application which performs all requests altogether.</p>
<p>More complex cases may require a session per site, e.g. one for
Github and other one for Facebook APIs. Anyway making a session for
every request is a <strong>very bad</strong> idea.</p>
<p>A session contains a connection pool inside. Connection reusage and
keep-alives (both are on by default) may speed up total performance.</p>
<p class="last">You may find more information about creating persistent sessions
in <a class="reference internal" href="client_advanced.html#aiohttp-persistent-session"><span class="std std-ref">Persistent session</span></a>.</p>
</div>
<p>A session context manager usage is not mandatory
but <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">session.close()</span></code> method
should be called in this case, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">):</span>
    <span class="c1"># ...</span>
<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="passing-parameters-in-urls">
<h2>Passing Parameters In URLs<a class="headerlink" href="#passing-parameters-in-urls" title="Permalink to this headline">¶</a></h2>
<p>You often want to send some sort of data in the URL’s query string. If
you were constructing the URL by hand, this data would be given as key/value
pairs in the URL after a question mark, e.g. <code class="docutils literal notranslate"><span class="pre">httpbin.org/get?key=val</span></code>.
Requests allows you to provide these arguments as a <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>, using the
<code class="docutils literal notranslate"><span class="pre">params</span></code> keyword argument. As an example, if you wanted to pass
<code class="docutils literal notranslate"><span class="pre">key1=value1</span></code> and <code class="docutils literal notranslate"><span class="pre">key2=value2</span></code> to <code class="docutils literal notranslate"><span class="pre">httpbin.org/get</span></code>, you would use the
following code:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="s1">&#39;value2&#39;</span><span class="p">}</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span>
                       <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="n">expect</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/get?key2=value2&amp;key1=value1&#39;</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="n">expect</span>
</pre></div>
</div>
<p>You can see that the URL has been correctly encoded by printing the URL.</p>
<p>For sending data with multiple values for the same key
<code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDict</span></code> may be used as well.</p>
<p>It is also possible to pass a list of 2 item tuples as parameters, in
that case you can specify multiple values for each key:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value2&#39;</span><span class="p">)]</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span>
                       <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
    <span class="n">expect</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/get?key=value2&amp;key=value1&#39;</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="n">expect</span>
</pre></div>
</div>
<p>You can also pass <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code> content as param, but beware – content
is not encoded by library. Note that <code class="docutils literal notranslate"><span class="pre">+</span></code> is not encoded:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span>
                       <span class="n">params</span><span class="o">=</span><span class="s1">&#39;key=value+1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;http://httpbin.org/get?key=value+1&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><em>aiohttp</em> internally performs URL canonicalization before sending request.</p>
<p>Canonicalization encodes <em>host</em> part by <a class="reference internal" href="glossary.html#term-idna"><span class="xref std std-term">IDNA</span></a> codec and applies
<a class="reference internal" href="glossary.html#term-requoting"><span class="xref std std-term">requoting</span></a> to <em>path</em> and <em>query</em> parts.</p>
<p>For example <code class="docutils literal notranslate"><span class="pre">URL('http://example.com/путь/%30?a=%31')</span></code> is converted to
<code class="docutils literal notranslate"><span class="pre">URL('http://example.com/%D0%BF%D1%83%D1%82%D1%8C/0?a=1')</span></code>.</p>
<p>Sometimes canonicalization is not desirable if server accepts exact
representation and does not requote URL itself.</p>
<p>To disable canonicalization use <code class="docutils literal notranslate"><span class="pre">encoded=True</span></code> parameter for URL construction:</p>
<div class="last highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="n">URL</span><span class="p">(</span><span class="s1">&#39;http://example.com/%30&#39;</span><span class="p">,</span> <span class="n">encoded</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Passing <em>params</em> overrides <code class="docutils literal notranslate"><span class="pre">encoded=True</span></code>, never use both options.</p>
</div>
</div>
<div class="section" id="response-content-and-status-code">
<h2>Response Content and Status Code<a class="headerlink" href="#response-content-and-status-code" title="Permalink to this headline">¶</a></h2>
<p>We can read the content of the server’s response and its status
code. Consider the GitHub time-line again:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/events&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
<p>prints out something like:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="mi">200</span>
<span class="s1">&#39;[{&quot;created_at&quot;:&quot;2015-06-12T14:06:22Z&quot;,&quot;public&quot;:true,&quot;actor&quot;:{...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> automatically decodes the content from the server. You can
specify custom encoding for the <code class="xref py py-meth docutils literal notranslate"><span class="pre">text()</span></code> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;windows-1251&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="binary-response-content">
<h2>Binary Response Content<a class="headerlink" href="#binary-response-content" title="Permalink to this headline">¶</a></h2>
<p>You can also access the response body as bytes, for non-text requests:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="sa">b</span><span class="s1">&#39;[{&quot;created_at&quot;:&quot;2015-06-12T14:06:22Z&quot;,&quot;public&quot;:true,&quot;actor&quot;:{...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">gzip</span></code> and <code class="docutils literal notranslate"><span class="pre">deflate</span></code> transfer-encodings are automatically
decoded for you.</p>
<p>You can enable <code class="docutils literal notranslate"><span class="pre">brotli</span></code> transfer-encodings support,
just install  <a class="reference external" href="https://pypi.org/project/Brotli">Brotli</a>.</p>
</div>
<div class="section" id="json-request">
<h2>JSON Request<a class="headerlink" href="#json-request" title="Permalink to this headline">¶</a></h2>
<p>Any of session’s request methods like <code class="xref py py-func docutils literal notranslate"><span class="pre">request()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.get()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.post()</span></code> etc. accept
<cite>json</cite> parameter:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>By default session uses python’s standard <code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code> module for
serialization.  But it is possible to use different
<code class="docutils literal notranslate"><span class="pre">serializer</span></code>. <code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code> accepts <code class="docutils literal notranslate"><span class="pre">json_serialize</span></code>
parameter:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ujson</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span>
        <span class="n">json_serialize</span><span class="o">=</span><span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">})</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">ujson</span></code> library is faster than standard <code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code> but slightly
incompatible.</p>
</div>
</div>
<div class="section" id="json-response-content">
<h2>JSON Response Content<a class="headerlink" href="#json-response-content" title="Permalink to this headline">¶</a></h2>
<p>There’s also a built-in JSON decoder, in case you’re dealing with JSON data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/events&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre></div>
</div>
<p>In case that JSON decoding fails, <code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code> will
raise an exception. It is possible to specify custom encoding and
decoder functions for the <code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code> call.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The methods above reads the whole response body into memory. If you are
planning on reading lots of data, consider using the streaming response
method documented below.</p>
</div>
</div>
<div class="section" id="streaming-response-content">
<h2>Streaming Response Content<a class="headerlink" href="#streaming-response-content" title="Permalink to this headline">¶</a></h2>
<p>While methods <code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">text()</span></code> are very
convenient you should use them carefully. All these methods load the
whole response in memory.  For example if you want to download several
gigabyte sized files, these methods will load all the data in
memory. Instead you can use the <a class="reference internal" href="client_reference.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content</span></code></a>
attribute. It is an instance of the <a class="reference internal" href="streams.html#aiohttp.StreamReader" title="aiohttp.StreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.StreamReader</span></code></a>
class. The <code class="docutils literal notranslate"><span class="pre">gzip</span></code> and <code class="docutils literal notranslate"><span class="pre">deflate</span></code> transfer-encodings are
automatically decoded for you:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/events&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>In general, however, you should use a pattern like this to save what is being
streamed to a file:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>
</div>
<p>It is not possible to use <code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">text()</span></code> after
explicit reading from <a class="reference internal" href="client_reference.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content</span></code></a>.</p>
</div>
<div class="section" id="more-complicated-post-requests">
<h2>More complicated POST requests<a class="headerlink" href="#more-complicated-post-requests" title="Permalink to this headline">¶</a></h2>
<p>Typically, you want to send some form-encoded data – much like an HTML form.
To do this, simply pass a dictionary to the <em>data</em> argument. Your
dictionary of data will automatically be form-encoded when the request is made:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="s1">&#39;value2&#39;</span><span class="p">}</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="o">...</span>
  <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span>
  <span class="p">},</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to send data that is not form-encoded you can do it by
passing a <code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code> instead of a <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>. This data will be
posted directly and content-type set to ‘application/octet-stream’ by
default:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">Binary-data</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If you want to send JSON data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">})</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>To send text with appropriate content-type just use <code class="docutils literal notranslate"><span class="pre">data</span></code> argument:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Тест&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="post-a-multipart-encoded-file">
<h2>POST a Multipart-Encoded File<a class="headerlink" href="#post-a-multipart-encoded-file" title="Permalink to this headline">¶</a></h2>
<p>To upload Multipart-encoded files:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/post&#39;</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;report.xls&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)}</span>

<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</pre></div>
</div>
<p>You can set the <code class="docutils literal notranslate"><span class="pre">filename</span></code> and <code class="docutils literal notranslate"><span class="pre">content_type</span></code> explicitly:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/post&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">FormData</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span>
               <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;report.xls&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">),</span>
               <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;report.xls&#39;</span><span class="p">,</span>
               <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/vnd.ms-excel&#39;</span><span class="p">)</span>

<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>If you pass a file object as data parameter, aiohttp will stream it to
the server automatically. Check <code class="xref py py-class docutils literal notranslate"><span class="pre">StreamReader</span></code>
for supported format information.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="multipart.html#aiohttp-multipart"><span class="std std-ref">Working with Multipart</span></a></p>
</div>
</div>
<div class="section" id="streaming-uploads">
<h2>Streaming uploads<a class="headerlink" href="#streaming-uploads" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp</span></code> supports multiple types of streaming uploads, which allows you to
send large files without reading them into memory.</p>
<p>As a simple case, simply provide a file-like object for your body:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;massive-body&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>Or you can use <em>asynchronous generator</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">file_sender</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">64</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">chunk</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">chunk</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">64</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>

<span class="c1"># Then you can use file_sender as a data provider:</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">file_sender</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;huge_file&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
<p>Because the <a class="reference internal" href="client_reference.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content</span></code></a> attribute is a
<a class="reference internal" href="streams.html#aiohttp.StreamReader" title="aiohttp.StreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamReader</span></code></a> (provides async iterator protocol), you
can chain get and post requests together:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://python.org&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
                   <span class="n">data</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="websockets">
<span id="aiohttp-client-websockets"></span><h2>WebSockets<a class="headerlink" href="#websockets" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp</span></code> works with client websockets out-of-the-box.</p>
<p>You have to use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.ClientSession.ws_connect()</span></code> coroutine
for client websocket connection. It accepts a <em>url</em> as a first
parameter and returns <a class="reference internal" href="client_reference.html#aiohttp.ClientWebSocketResponse" title="aiohttp.ClientWebSocketResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientWebSocketResponse</span></code></a>, with that
object you can communicate with websocket server using response’s
methods:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">ws_connect</span><span class="p">(</span><span class="s1">&#39;http://example.org/ws&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ws</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">WSMsgType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;close cmd&#39;</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send_str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;/answer&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">WSMsgType</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
            <span class="k">break</span>
</pre></div>
</div>
<p>You <strong>must</strong> use the only websocket task for both reading (e.g. <code class="docutils literal notranslate"><span class="pre">await</span>
<span class="pre">ws.receive()</span></code> or <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">for</span> <span class="pre">msg</span> <span class="pre">in</span> <span class="pre">ws:</span></code>) and writing but may have
multiple writer tasks which can only send data asynchronously (by
<code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">ws.send_str('data')</span></code> for example).</p>
</div>
<div class="section" id="timeouts">
<span id="aiohttp-client-timeouts"></span><h2>Timeouts<a class="headerlink" href="#timeouts" title="Permalink to this headline">¶</a></h2>
<p>Timeout settings are stored in <a class="reference internal" href="client_reference.html#aiohttp.ClientTimeout" title="aiohttp.ClientTimeout"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientTimeout</span></code></a> data structure.</p>
<p>By default <em>aiohttp</em> uses a <em>total</em> 300 seconds (5min) timeout, it means that the
whole operation should finish in 5 minutes.</p>
<p>The value could be overridden by <em>timeout</em> parameter for the session (specified in seconds):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">timeout</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Timeout could be overridden for a request like <code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.get()</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Supported <a class="reference internal" href="client_reference.html#aiohttp.ClientTimeout" title="aiohttp.ClientTimeout"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientTimeout</span></code></a> fields are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">total</span></code></p>
<blockquote>
<div>The maximal number of seconds for the whole operation including connection
establishment, request sending and response reading.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">connect</span></code></p>
<blockquote>
<div>The maximal number of seconds for
connection establishment of a new connection or
for waiting for a free connection from a pool if pool connection
limits are exceeded.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">sock_connect</span></code></p>
<blockquote>
<div>The maximal number of seconds for connecting to a peer for a new connection, not
given from a pool.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">sock_read</span></code></p>
<blockquote>
<div>The maximal number of seconds allowed for period between reading a new
data portion from a peer.</div></blockquote>
</div></blockquote>
<p>All fields are floats, <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code> disables a particular timeout check, see the
<a class="reference internal" href="client_reference.html#aiohttp.ClientTimeout" title="aiohttp.ClientTimeout"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientTimeout</span></code></a> reference for defaults and additional details.</p>
<p>Thus the default timeout is:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">sock_connect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sock_read</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/teanga-logo.svg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=pret-a-llod&repo=teanga&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../create_workflow.html">How to create a workflow in Teanga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run_workflow.html">How to run a workflow in Teanga</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, teanga maintainers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/examples/client_quickstart.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/pret-a-llod/teanga" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>